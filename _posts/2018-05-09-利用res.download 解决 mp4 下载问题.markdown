---
layout: post
title:  "MP4 自动打开怎么办?"
date:   2018-05-10 11:41:02 +0800
categories: Nodejs
---
最近项目遇到一个需求,需要对 MP4 进行下载处理.但是服务器返回的 视频文件 自动会被浏览器打开,如何解决下载问题呢. 

查找了很多资料,发现 Nodejs 的 res.download 专门为此设计. 如果有类似需求可以用来试试. 

语法如下:

 
```js
 res.download('/xxx.pdf','dl.pdf',function(err){
	if(err){
	//如何如何
	}
})
```
功能不错,缺点貌似是 可下载的文件必须是 本服务器上的文件,如果是外面的文件貌似不可以. 


待续...


11:16 update

我们这个场景有点怪,用 nodejs 做了反向代理, 结果 发现 res.download 根本不认反向代理的 路径,(猜测反向代理必须是 用户自己发起的 才能算是反向代理?) 

anyway, 最后尝试在做反向代理前 做了拦截, 设置了一下 header. 解决了问题. 不过 大文件的代理,需要服务器的等级会比较高. 

代码如下:



```js
app.use('/getvd',function(req,res,next){
	res.set("Content-Disposition","attachment")
	next()
})
```


功能很理想,现实狠骨感.发现用 一个 小的服务器 根本带不动10个 并发左右的下载. 
这种情况下, 突然想到了 CDN 也许是个不错的选择. 不知道 Azure CDN 是否有类似服务. 
 




 

 



[jekyll-docs]: https://jekyllrb.com/docs/home
[jekyll-gh]:   https://github.com/jekyll/jekyll
[jekyll-talk]: https://talk.jekyllrb.com/
